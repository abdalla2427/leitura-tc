#include <stdio.h>
#include <math.h>
#define tamanhoJanela 5
#define tamanhoSaidaRede 2
#define tamanhoCamadaInterna 5
#define debug 1

float entradaRede[tamanhoJanela] = { 0 };
float camada1[tamanhoCamadaInterna] = { 0 };
float camada2[tamanhoCamadaInterna] = { 0 };
float saidaRede[tamanhoSaidaRede] = { 0 };

float biasEntrada[tamanhoCamadaInterna] = { 1.31951695, -1.17376615, -0.71409326, -0.55870824, -0.1274779 };
float biasCamada1[tamanhoCamadaInterna] = {-0.69192777, -0.39505221,  0.02265227, -0.17027953, -0.87033633};
float biasCamada2[tamanhoSaidaRede] = {-6.00660515,  2.97287126};

int numeroDeNeuroniosDeSaida;

//pesosParaCamdaX[NohOrigem][NohDestino]
float pesosParaCamada1[5][5] = {{-2.21595734,  0.13902692, -0.77176005, -0.34096085, -1.8570363 },
                { 0.33239099, -0.91424223, -0.23843466, -0.19490422, -0.99810873},
                {-0.30775306, -0.36917993, -0.45628827,  0.40991321, -1.68630635},
                {-0.4026412 , -1.01636876,  0.09060966, -0.72841166, -0.7430336 },
                { 2.99476762, -0.75755223, -0.28804942,  0.16319673,  1.30222625}};

float pesosParaCamada2[5][5] = {{-0.62010158,  0.50114589,  0.92234769, -0.20217932,  2.23636883},     
                {-0.28482048,  0.29105352,  0.19711757, -0.74399458,  0.49794197},
                { 0.75473956,  0.38313632, -0.33896665,  0.44661062, -0.61256876},
                {-0.08044579,  0.6414196 , -0.42731671, -0.32764798, -0.48729865},
                {-0.7420365 ,  0.80040399, -0.54578971, -0.36181863,  1.71091415}};

float pesosParaCamada3[5][2] = {{-0.73380492, -0.15859089},
                { 0.33740235, -0.70982787},
                {-0.61637897,  0.66683674},
                { 0.2132334 ,  0.00978615},
                { 0.98322924, -2.29419219}};

//Vetor para teste da RNA
float vetorEntradas[100][5] = {{0.7229986115623536, 0.19509200436247787, 0.7849556681279058, 0.28689232605514414, 0.26658855440176077}, {0.043698219159143736, 0.9361554925428931, 0.24846675337542068, 0.18447383141912288, 0.8904684998812215}, {0.8522545598720415, 0.01130143720816823, 0.5942671351774969, 0.013278580607276935, 0.1700987125671105}, {0.05164512557475154, 0.8329478660400417, 0.2827660257009533, 0.4459430088078461, 0.8819368071099962}, {0.22814936021458865, 0.7472829208139924, 0.1417284767488881, 0.4947327665460389, 0.8385423990339614}, {0.6390809642165746, 0.29583168752015965, 0.020686114347692963, 0.33475086091997197, 
0.8869762206301628}, {0.3197529637295854, 0.041364338793043354, 0.4811449898884489, 0.15923588838869607, 0.6738587415578814}, {0.07592023113780066, 0.47442054659073485, 0.4841024916621751, 0.27092442838117725, 0.4497546038931184}, {0.5314966528872712, 0.12579368144106362, 0.12158425433841102, 0.9494606032407407, 0.9741726427295516}, {0.42780041292712456, 0.044244120485722016, 0.9244765424622541, 0.6455439816863603, 0.4577173978346182}, {0.601363662048213, 0.10721959367980449, 0.6287706100644012, 0.32740806744231443, 0.28729493956133867}, {0.8165605520946445, 0.6657660588776074, 0.25352099921177673, 0.1316478168277354, 0.18890251079585518}, {0.09624151249314117, 0.41082172831835195, 0.8842401548079517, 0.5108660137460704, 0.8768370642517984}, {0.7266785754143681, 0.9001210722829299, 0.19802136001437853, 0.7801475141869488, 0.8136131462669184}, {0.20227451472147995, 0.9104900158550364, 0.7083585838128194, 0.9535532240421111, 0.32947544742382817}, {0.08260519030312297, 0.192602130838883, 0.34072534308755087, 0.19326191361026235, 0.6631122280452677}, {0.5963660304014429, 0.3786220796611779, 0.7120194110269549, 0.32693424795782655, 0.2747029360108012}, {0.31826732545961345, 0.08581852991698313, 0.1732902054258646, 0.29618741714580765, 0.5195157159112704}, {0.734776956486585, 0.00980064848701978, 0.3485734438313194, 0.3056734443902923, 0.20395336390263985}, {0.0003288397502297924, 0.5292149590849303, 0.5500315631779329, 0.12093032318123231, 0.7619321164820289}, {0.5114806255919389, 0.7244226062965278, 0.5637761520052962, 0.18149685144034522, 0.4271147825146717}, {0.344791429048949, 0.10380451641480226, 0.27857306216181255, 0.8767264260713948, 0.8782527210170734}, {0.16512611894490115, 0.020845914947697053, 0.17453257091978647, 0.39348658688294236, 0.6123102190276549}, {0.5328191437367358, 0.4989759425222976, 0.7894303674763073, 0.4246400131281378, 0.6973402353323148}, {0.6880364842935585, 0.08943258553432043, 0.0924657013191118, 0.5573654993965682, 0.7698033176422675}, {0.5456114473021266, 0.423110968644852, 0.9332421927766191, 0.3098023050381924, 0.7714732814830058}, {0.9972500136894974, 0.6861951657798295, 0.6648274842305769, 0.4755342956979258, 0.9012922293176373}, {0.37110665328879544, 0.01831262662123445, 0.7974024726193684, 0.18852936916189655, 0.5249517144334176}, {0.9006999143833088, 0.09225868834318252, 0.9007935564787328, 0.8477895952685686, 0.9274823307868338}, {0.34245810984653524, 0.20269507549270582, 0.5018637687424986, 0.28346070761216935, 0.017980464409224406}, {0.9187180737313579, 0.23550066036355133, 0.7584776664906967, 0.4206949482001152, 0.8621404916419314}, {0.3805503157382878, 0.23811184843871214, 0.0016085952910193102, 0.05743613247114632, 0.7883725095626586}, {0.26124716948343996, 0.7604232397687847, 0.1580724854182206, 0.4418481142673317, 0.3916632259679276}, {0.5539115492318624, 0.49005416143458147, 0.12212331903277196, 0.01079584184833049, 0.3097063895072424}, {0.5376876414227438, 0.9259637796071668, 0.6745782978609909, 0.9141927147190524, 0.6306150932098787}, {0.7662652075233148, 0.43372519775311813, 0.5556277360408403, 0.0009332413910201343, 0.027647383420100757}, {0.3721079605791088, 0.5435562862225712, 0.9245740836114428, 0.38846533605229616, 0.9110273268148348}, {0.663528497312518, 0.5712854472425416, 0.7804171700806865, 0.7471139589703745, 0.13444051758568298}, {0.8248013852391135, 0.4586860350935005, 0.26369503462603305, 0.17749058058249378, 0.03636338906794512}, {0.6591857917223642, 0.8324530519000009, 0.08822659830364332, 0.5424756924438496, 0.17555832609536093}, {0.5149428996593488, 0.442868163593808, 0.6567106081109215, 0.5771599750454011, 0.5686074608794264}, {0.7951415770289763, 0.3294629999563494, 0.6436621472011128, 0.4901220856869669, 0.262259308774729}, {0.27896705667915767, 0.11530465625177333, 0.3064356091894498, 0.7270313569229562, 0.09026296132855516}, {0.7274661962126978, 0.9366262262680991, 0.7288735478676448, 0.9740158243202394, 0.9085808764892913}, {0.6579987664205769, 0.24779092900595356, 0.23547295428321824, 0.35137487389438493, 0.7825105406509792}, {0.043692090786437654, 0.5266022794889291, 0.07917499579731613, 0.3623711978544466, 0.16497667248820247}, {0.473562523577181, 0.1916738014164503, 0.9244946118011862, 0.08803174444545447, 0.021315595941262977}, {0.6746265673608502, 0.5235239943502369, 0.8428493596495045, 0.23384428519267952, 0.3578619080821499}, {0.25010611033783814, 0.329062837288293, 0.6612994016039776, 0.0881159774372281, 0.9608248309244568}, {0.2284908799018215, 0.284873903764033, 0.9691302053178996, 0.7829077101266767, 0.6914220741475504}, {0.265702833489047, 0.06009787706590619, 0.6151270730831286, 0.39464917975662495, 0.042348333319330855}, {0.0981774073605497, 0.27051255814327335, 0.9977466031460803, 0.8599890865904374, 0.9891734959568468}, {0.11926143226456531, 0.20521088898978956, 0.23471876591883423, 0.24097952596168304, 0.737678090622041}, {0.0029097174291503602, 0.030586316792037938, 0.01972691848226138, 0.6352014803078572, 0.3749968430120715}, {0.8882149514283516, 0.6117895503331682, 0.8376233855341116, 0.7912960327300141, 0.4018032024626622}, {0.30928798244621836, 0.886041677245704, 0.5861468665254403, 0.8716188427625186, 0.8536817131566631}, {0.9723812150685279, 0.29851536210067575, 0.49055808707416404, 0.06078273425169711, 0.44548591258254555}, {0.5651310194871555, 0.2854512164269922, 0.5366643331482368, 0.8914729310639325, 0.9619970990447758}, {0.1628251794487302, 0.3508037072988307, 0.4257811488141233, 0.5589859492981033, 0.44660654135266664}, {0.3641297061254134, 0.6485146771673461, 0.07291885653842434, 0.1562457816013212, 0.19700645030880426}, {0.9565599792235693, 0.6403974936637516, 0.0897265005348753, 0.5100214565428908, 0.20932942305176772}, {0.2726039995608869, 0.40282764748295796, 0.6463328290689874, 0.2723624348291702, 0.7817899243794741}, {0.5003186632410821, 0.6400861625703486, 0.6019517852497119, 0.45556593830224845, 0.44996215736010703}, {0.2552202465634923, 0.10638681365887293, 0.34103976250855017, 0.009110052897442933, 0.046453713338720726}, {0.6480631499841739, 0.5045250579687436, 0.35380669409355814, 0.4133949568646783, 0.25704003256326724}, {0.3554279049064145, 0.7616151515828835, 0.3554521394695537, 0.23551003290704042, 
0.6958487990696357}, {0.6807853015206765, 0.8261801683088061, 0.9176599564044196, 0.13526575860468149, 0.13210620121799588}, {0.8065004704546004, 0.5442530333939728, 0.861664388489058, 0.9274237875619499, 0.7018163121697717}, {0.04715734482205591, 0.795747239703703, 0.9462231834910981, 0.8336295124539924, 0.49984899612715117}, {0.4011462638755654, 0.2470450600417361, 0.3167895812459187, 0.6365723418460438, 0.874846574053312}, {0.8376629951088317, 0.292555915316141, 0.19614805062810925, 0.6853949290886086, 0.9543378788529199}, 
{0.93340750393128, 0.42066168319966724, 0.4808877565884675, 0.2538562403384279, 0.1307733368203382}, {0.3685988129949901, 0.3448631730693428, 0.053620266086638835, 0.3793481997963971, 0.5582546039608292}, {0.9055637003083697, 0.996521288061948, 0.686892315680354, 0.2423705632789397, 0.3973474813788911}, {0.5665077797141588, 0.7678164194756638, 0.07812137248112239, 0.03597452601049911, 0.9090952785786335}, {0.7446723667634711, 0.30734814263186083, 0.76687769201766, 0.9507691761532717, 0.08146791880668858}, {0.4405196083391757, 
0.594891194284507, 0.5512000550052608, 0.3609862517046244, 0.623108073836846}, {0.2302014336037823, 0.3180619928898132, 0.789709933126555, 0.7681352095544275, 0.3117575531717216}, {0.9938584456494923, 0.40219103876036955, 0.6171152411094081, 0.49152949283126, 0.7991683347402624}, {0.1779282414620338, 0.23815149757822285, 0.301569780077101, 0.3273938772238322, 0.23398997781465303}, {0.018120730351668057, 0.8338266353556968, 0.6063279529861425, 0.7745194468965981, 0.3573618825154419}, {0.9003041066568912, 0.06888073075620327, 0.8708850736180216, 0.9980112052847634, 0.11670734632275104}, {0.6343182552385898, 0.5502679241840801, 0.40121661854275736, 0.7236407259105282, 0.7839863977182655}, {0.0753559626429755, 0.2769229590397687, 0.07970938900679791, 0.8556176983826719, 0.34811988422870077}, {0.6133701295586683, 0.7588771391092083, 0.056744121416272275, 0.7513593086379684, 0.09760573604349398}, {0.2201680995799733, 0.2614895625996657, 0.7389766047753202, 0.2977793997419582, 0.8824930964389649}, {0.788439348002537, 0.9311167246392605, 0.020884121675628142, 0.6031908121987365, 0.1553226883914295}, {0.7424614996502331, 0.39814430236268994, 0.404703924452369, 0.6346575274291303, 0.7602144072202227}, {0.9272732596343047, 0.0916199528756918, 0.5841864787477898, 0.8955537240510559, 
0.34970416382835734}, {0.9049616349079552, 0.8625427049740657, 0.8174044745723085, 0.8672480170398201, 0.463692653220273}, {0.1760882979950804, 0.7926054013010421, 0.8949636953037662, 0.6477844837100113, 0.06796421999932578}, {0.6335531511946588, 0.657060378417579, 0.29788103786548703, 0.9647957799892876, 0.33240232470798514}, {0.6898463545824535, 0.3587854247863732, 0.8571027029362112, 0.5843782973975831, 0.7232632810904829}, {0.35976253015412574, 0.022195650908530262, 0.7284854817010207, 0.6281754421433792, 0.8047792305517406}, {0.30999360506946094, 0.2770226702454224, 0.7507708093323664, 0.47804573370203673, 0.6912543728074184}, {0.6158073646634495, 0.29069746909278926, 0.6155299220902719, 0.5190458748564261, 0.7051396315258941}, {0.8856250559781482, 0.02922403018004971, 0.308929475790356, 0.47536727307249727, 0.6982927395632439}, {0.7511662485344881, 0.35145716740896227, 0.15793591029058096, 0.5382784723708949, 0.37766385743902353}, {0.8743548494982648, 0.35980753890263184, 0.009033301045301978, 0.8943989749158915, 0.5621244115149279}, {0.07413549919409868, 0.30627399476756567, 0.03265390885685604, 0.683155292383063, 0.43322586124967166}};


float maximo(float a, float b);

float reluFunction(float valor);

float logisticFunction(float valor);

int propagarEntradaParaProximaCamada(float *entrada, int tamanhoEntrada, float *saida, int tamanhoSaida, float pesos[][tamanhoCamadaInterna], float biasRede[]);

int propagarEntradaParaSaida(float *entrada, int tamanhoEntrada, float *saida, int tamanhoSaida, float pesos[][tamanhoSaidaRede], float biasRede[]);

int main() {
    int tuplaBaseTeste;
    int amostra;

    for (tuplaBaseTeste = 0; tuplaBaseTeste < 2; tuplaBaseTeste++) {
        for (amostra = 0; amostra < tamanhoJanela; amostra++) {
            camada1[amostra] = 0;
            camada2[amostra] = 0;
            entradaRede[amostra] = vetorEntradas[tuplaBaseTeste][amostra];
        }
        saidaRede[0] = 0;
        saidaRede[1] = 0;

        propagarEntradaParaProximaCamada(entradaRede, tamanhoJanela, camada1, tamanhoCamadaInterna, pesosParaCamada1, biasEntrada);
        propagarEntradaParaProximaCamada(camada1, tamanhoCamadaInterna, camada2, tamanhoCamadaInterna, pesosParaCamada2, biasCamada1);
        propagarEntradaParaSaida(camada2, tamanhoCamadaInterna, saidaRede, tamanhoSaidaRede, pesosParaCamada3, biasCamada2);
    }

    return 0;
}

float reluFunction(float valor) {
    return maximo(0, valor);
}

float logisticFunction(float valor) {
    if (valor >= 10)
        return 1;
    if (valor < -10)
        return 0;
    else {
        float resultado = (1 / (1 + expf(valor * (-1.0) ) ) );

        if (resultado >= 0.5)
            return 1.0;
        else
            return 0.0;
    }
}

float maximo(float a, float b)
{
    return ((a >= b) ? a : b);
}

int propagarEntradaParaProximaCamada(float *entrada, int tamanhoEntrada, float *saida, int tamanhoSaida, float pesos[][tamanhoCamadaInterna], float biasRede[])
{
    int i;
    int j;
    float auxEntrada;
    float auxPesos;
    for (i = 0; i < tamanhoEntrada; i++) {
        for (j = 0; j < tamanhoSaida; j++) {
            auxEntrada = entrada[i];
            auxPesos = pesos[i][j];
            saida[j] += auxEntrada * auxPesos;
        }
    }

    for (i = 0; i < tamanhoSaida; i++) {
        saida[i] = reluFunction(saida[i] + biasRede[i]);
        printf("%f ", saida[i]);
    }
    printf("\n");
    
    return;
}

int propagarEntradaParaSaida(float *entrada, int tamanhoEntrada, float *saida, int tamanhoSaida, float pesos[][tamanhoSaidaRede], float biasRede[])
{
    int i;
    int j;
    float auxEntrada;
    float auxPesos;
    for (i = 0; i < tamanhoEntrada; i++) {
        for (j = 0; j < tamanhoSaida; j++) {
            auxEntrada = entrada[i];
            auxPesos = pesos[i][j];
            saida[j] += auxEntrada * auxPesos;
        }
    }

    for (i = 0; i < tamanhoSaida; i++) {
        saida[i] = logisticFunction(saida[i] + biasRede[i]);
        printf("%f ", saida[i]);
    }
    printf("\n");

    return;
}